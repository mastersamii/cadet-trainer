<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cadet Trainer ‚Äî 10-Codes Flashcards, Quiz & Matching</title>
<style>
  :root{
    --bg:#0e1220;
    --panel:#151a2b;
    --ink:#e8eaf6;
    --muted:#9aa3b2;
    --accent:#9aa3b2;
    --accent-strong:#cfd4df;
    --card:#11172a;
    --success:#22a05d;
    --danger:#d64545;
    --radius:22px;
    --shadow:0 18px 50px rgba(0,0,0,.35);
  }

  [data-theme="sasp"]{ --bg:#0e1220; --panel:#151a2b; --ink:#e8eaf6; --muted:#9aa3b2; --accent:#9aa3b2; --accent-strong:#cfd4df; --card:#11172a; }
  [data-theme="bcso"]{ --bg:#17140f; --panel:#1f1a12; --ink:#fff8e6; --muted:#d2c5aa; --accent:#c7a976; --accent-strong:#efd9a7; --card:#19140e; }
  [data-theme="highway"]{ --bg:#071226; --panel:#0b1d35; --ink:#e6f2ff; --muted:#a8c2e5; --accent:#2e6ac9; --accent-strong:#a7c8ff; --card:#0a1730; }

  body{margin:0;font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--ink);display:flex;min-height:100vh;align-items:center;justify-content:center;padding:20px;}
  .app{ width:min(1200px,100%); display:grid; grid-template-columns:320px 1fr; gap:24px; margin:0 auto; align-items:start; }
  .sidebar{ background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; position:sticky; top:20px; align-self:start; height:max-content; border:1px solid rgba(255,255,255,.06); }
  h1{font-size:24px;margin:0 0 6px;font-weight:900}
  .sub{color:var(--muted);font-size:13px;margin:0 0 12px}
  .select{width:100%;padding:12px 14px;background:var(--card);color:var(--ink);border:1px solid rgba(255,255,255,.08);border-radius:14px;margin:8px 0 14px;cursor:pointer;}
  .stat{display:flex;justify-content:space-between;background:var(--card);border-radius:14px;padding:10px 14px;margin:6px 0;border:1px solid rgba(255,255,255,.06)}
  .panel{ background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px; min-height:600px; border:1px solid rgba(255,255,255,.06); overflow:auto; }
  .toolbar{display:flex;justify-content:space-between;margin-bottom:14px}
  .tag{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);color:var(--accent-strong);font-size:12px;}
  .btn{padding:10px 14px;border-radius:14px;background:var(--accent);color:#0c0f18;font-weight:800;border:none;cursor:pointer;}
  .btn.ghost{background:transparent;color:var(--accent-strong);border:1px solid rgba(255,255,255,.14)}
  .cardwrap{display:grid;place-items:center;padding:20px;}
  .card{width:100%;min-height:240px;perspective:1200px;}
  .face{ background:linear-gradient(180deg, var(--card), rgba(255,255,255,.02)); color:var(--ink); border-radius:28px; padding:30px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.08); font-size:clamp(16px, 2.8vw, 34px); font-weight:900; line-height:1.15; display:flex; align-items:center; justify-content:center; text-align:center; height:100%; transition:transform .6s ease, box-shadow .3s ease; transform-style:preserve-3d; overflow-wrap:anywhere; word-break:break-word; hyphens:auto; }
  .flipper{position:relative}
  .flipper .front,.flipper .back{position:absolute;inset:0;backface-visibility:hidden}
  .flipper .back{transform:rotateY(180deg)}
  .flipped .front{transform:rotateY(180deg)}
  .flipped .back{transform:rotateY(360deg)}
  .qwrap{display:grid;gap:14px}
  .q{padding:18px;border-radius:16px;background:var(--card);border:1px solid rgba(255,255,255,.08)}
  .choices{display:grid;gap:10px;margin-top:8px}
  .choice{padding:12px 14px;border-radius:12px;background:rgba(255,255,255,.05);cursor:pointer;border:1px solid rgba(255,255,255,.08)}
  .choice.correct{outline:2px solid var(--success);background:rgba(34,160,93,.12)}
  .choice.wrong{outline:2px solid var(--danger);background:rgba(214,69,69,.12)}
  .match-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  .match-item{padding:10px;border-radius:10px;background:var(--card);cursor:pointer;border:1px solid rgba(255,255,255,.08);font-size:14px}
  .match-item.correct{background:rgba(34,160,93,.2)}
  .match-item.wrong{background:rgba(214,69,69,.2)}
  /* Matching styles */
  .match-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
  @media (max-width: 820px){ .match-grid{ grid-template-columns:1fr } }
  .match-item{ padding:12px; border-radius:12px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); cursor:pointer; user-select:none }
  .match-item.sel{ outline:2px solid var(--accent-strong); background:rgba(255,255,255,.08) }
  .match-item.correct{ outline:2px solid var(--success); background:rgba(34,160,93,.12) }
  .match-item.wrong{ outline:2px solid var(--danger); background:rgba(214,69,69,.12) }
</style>
</head>
<body data-theme="sasp">
<div id="root-app" class="app">
  <aside class="sidebar">
    <h1>Cadet Trainer</h1>
    <p class="sub">Practice 10-codes and case laws. Flashcards, quiz, or matching.</p>

    <label class="sub">Theme</label>
    <select class="select" id="theme">
      <option value="sasp">SASP ‚Äî Black/Grey</option>
      <option value="bcso">BCSO ‚Äî Tan</option>
      <option value="highway">Highway ‚Äî Blue</option>
    </select>

    <label class="sub">Mode</label>
    <select class="select" id="mode">
      <option value="flash">Flashcards</option>
      <option value="quiz">Quiz</option>
      <option value="match">Matching</option>
      <option value="caselaw">Case Law Quiz</option>
      <!-- NEW -->
      <option value="contraband">Contraband Quiz</option>
      <option value="negotiations">Negotiations Quiz</option>
      <option value="weapons">Weapon Class Quiz</option>
      <option value="drugs">Drug Class Quiz</option>
    </select>

    <div class="stat"><span>Seen</span><strong id="seen">0</strong></div>
    <div class="stat"><span>Correct</span><strong id="correct">0</strong></div>
    <div class="stat"><span>Streak</span><strong id="streak">0</strong></div>
    <div class="stat"><span>All-time Streak üèÜ</span><strong id="alltime">0</strong></div>

    <button class="btn ghost" id="shuffleBtn" style="width:100%;margin-top:12px">Shuffle Deck</button>
    <button class="btn ghost" id="resetBtn" style="width:100%;margin-top:8px">Reset Stats</button>
    <button class="btn ghost" id="resetAllBtn" style="width:100%;margin-top:8px">Reset All-time Streak</button>
  </aside>

  <main class="panel">
    <div class="toolbar"><span class="tag" id="tag">Flashcards</span></div>

    <section id="flashSection" class="cardwrap">
      <div class="card"><div class="flipper" id="flipper"><div class="face front" id="front">Tap card to flip</div><div class="face back" id="back"></div></div></div>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button class="btn ghost" id="markWrong">Wrong</button>
        <button class="btn" id="markRight">Right</button>
      </div>
    </section>

    <section id="quizSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="qcount">Question</div><div id="qscore">0 correct</div></div>
          <h2 id="qtext"></h2>
          <div class="choices" id="choices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartQuiz">Restart</button>
          <button class="btn" id="nextQ">Next</button>
        </div>
      </div>
    </section>

    <section id="matchSection" style="display:none">
      <div class="qmeta" style="margin-bottom:10px"><div id="mcount">Match the pairs</div><div id="mleft"></div></div>
      <div id="matchGrid" class="match-grid"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px">
        <button class="btn ghost" id="restartMatch">New Board</button>
      </div>
    </section>

    <section id="caseSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="cqcount">Case Question</div><div id="cqscore">0 correct</div></div>
          <h2 id="cqtext"></h2>
          <div class="choices" id="cchoices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartCase">Restart</button>
          <button class="btn" id="nextCase">Next</button>
        </div>
      </div>
    </section>

    <!-- Contraband Yes/No -->
    <section id="contrabandSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="bcount">Contraband Question</div><div id="bscore">0 correct</div></div>
          <h2 id="btext"></h2>
          <div class="choices" id="bchoices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartContra">Restart</button>
          <button class="btn" id="nextContra">Next</button>
        </div>
      </div>
    </section>

    <!-- NEW: Negotiations MCQ -->
    <section id="negotiationsSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="ncount">Negotiations Question</div><div id="nscore">0 correct</div></div>
          <h2 id="ntext"></h2>
          <div class="choices" id="nchoices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartNeg">Restart</button>
          <button class="btn" id="nextNeg">Next</button>
        </div>
      </div>
    </section>

    <!-- NEW: Weapon Class Quiz -->
    <section id="weaponSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="wcount">Weapon Class Question</div><div id="wscore">0 correct</div></div>
          <h2 id="wtext"></h2>
          <div class="choices" id="wchoices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartWeap">Restart</button>
          <button class="btn" id="nextWeap">Next</button>
        </div>
      </div>
    </section>

    <!-- NEW: Drug Class Quiz -->
    <section id="drugSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="dcount">Drug Class Question</div><div id="dscore">0 correct</div></div>
          <h2 id="dtext"></h2>
          <div class="choices" id="dchoices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartDrug">Restart</button>
          <button class="btn" id="nextDrug">Next</button>
        </div>
      </div>
    </section>

  </main>
</div>
<script>
// === DATA ===
const CODES = [
  {c:'Code 0', m:'Game Crash'},
  {c:'Code 1', m:'Routing Call (No Lights | No Sirens)'},
  {c:'Code 2', m:'Routing Call (Lights | No Sirens | Airhorn at Intersections)'},
  {c:'Code 3', m:'Emergency (Lights | Sirens)'},
  {c:'Code 4', m:'All Clear'},
  {c:'Code 5', m:'Initiate Felony Stop'},
  {c:'Code 6', m:'Investigating the Area'},
  {c:'10-1', m:'Unable to Copy'},
  {c:'10-2', m:'Loud and Clear'},
  {c:'10-3', m:'Stop Radio Chatter'},
  {c:'10-4', m:'Acknowledgment'},
  {c:'10-5', m:'Ballistics Testing'},
  {c:'10-6', m:'Busy, unless urgent'},
  {c:'10-7', m:'Out of Service'},
  {c:'10-8', m:'Back in Service'},
  {c:'10-9', m:'Repeat'},
  {c:'10-10', m:'Negative'},
  {c:'10-11', m:'Traffic Stop'},
  {c:'10-13', m:'Shots Fired'},
  {c:'10-14', m:'Officer Down'},
  {c:'10-15', m:'Suspect in Custody'},
  {c:'10-19', m:'Return to Station'},
  {c:'10-20', m:'Location'},
  {c:'10-22', m:'Disregard'},
  {c:'10-23', m:'Arrived at the Scene'},
  {c:'10-25', m:'Report in Person'},
  {c:'10-28', m:'Vehicle Registration'},
  {c:'10-29', m:'Warrant Check'},
  {c:'10-31', m:'Crime in Progress'},
  {c:'10-32', m:'Person with a Gun'},
  {c:'10-33', m:'Drug Sales'},
  {c:'10-39', m:'Status Report'},
  {c:'10-41', m:'On Duty'},
  {c:'10-42', m:'Off Duty'},
  {c:'10-47', m:'Injured Person'},
  {c:'10-50', m:'Vehicle Accident'},
  {c:'10-51', m:'Requesting a Tow Truck'},
  {c:'10-52', m:'EMS Needed'},
  {c:'10-53', m:'Requesting Supervisor'},
  {c:'10-55', m:'Intoxicated Driver'},
  {c:'10-56', m:'Intoxicated Pedestrian'},
  {c:'10-57', m:'Hit & Run'},
  {c:'10-60', m:'Stolen Vehicle'},
  {c:'10-66', m:'Suspicious Person'},
  {c:'10-67', m:'Carjacking (GTA)'},
  {c:'10-71', m:'Shooting'},
  {c:'10-72', m:'Hostage Situation'},
  {c:'10-76', m:'En-route'},
  {c:'10-77', m:'Need Backup (Non-Emergency)'},
  {c:'10-78', m:'Need Backup (Emergency)'},
  {c:'10-79', m:'ETA (Estimated Time of Arrival)'},
  {c:'10-80', m:'Vehicle Pursuit'},
  {c:'10-81', m:'Foot Pursuit'},
  {c:'10-90', m:'Robbery in Progress'},
  {c:'10-91', m:'Transport Unit'},
  {c:'10-94', m:'Reckless Driver'},
  {c:'10-99', m:'Officer in Distress'}
];

const CASES = [
  {name:'Tennessee v. Garner', sum:'Deadly force to stop a fleeing suspect only if there is a good-faith belief the suspect poses a significant threat of death or serious injury to officers or others.'},
  {name:'Maryland v. King', sum:'After arrest on probable cause, an individual may be fingerprinted, photographed, and have DNA taken without a warrant.'},
  {name:'Florida v. J.L.', sum:'An anonymous tip alone is not enough for a search or frisk; it can help corroborate reasonable suspicion for an investigatory stop.'},
  {name:'Mapp v. Ohio', sum:'Evidence obtained unlawfully may not be used in prosecution (exclusionary rule).'},
  {name:'Carroll v. United States', sum:'With probable cause, a vehicle can be searched without a warrant (automobile exception). Buildings generally require a warrant.'},
  {name:'Miranda v. Arizona', sum:'Suspects must be warned of their rights prior to questioning; otherwise statements are inadmissible unless rights were knowingly and intelligently waived.'},
  {name:'Terry v. Ohio', sum:'With reasonable suspicion a suspect committed, is committing, or is about to commit a crime and may be armed and dangerous, an officer may conduct a stop-and-frisk based on specific articulable facts.'},
  {name:'Whren v. U.S.', sum:'A vehicle may be stopped when there is probable cause of a traffic violation, even if the officer‚Äôs actual intent is not traffic enforcement; a traffic stop is a form of detention.'},
  {name:'Pennsylvania v. Mimms', sum:'During a lawful traffic stop, officers may order the driver out of the car and conduct a pat-down for weapons under Terry criteria.'},
  {name:'Maryland v. Wilson', sum:'Extends Mimms to passengers, officers may order passengers out and pat them down under Terry criteria.'},
  {name:'Brendlin v. California', sum:'A lawful traffic stop detains passengers as well as the driver; no one is free to depart without police permission.'}
];

// CONTRABAND (Yes) ‚Äî your list + ‚Äúshould be taken off a suspect‚Äù
const CONTRA_YES = [
  'red decryption key','blue decryption key','green decryption key',
  'chip','raspberry chip','fake plates','meth table','catalytic converter','pager',
  // weapons (any class)
  // Class 2
  'Ceramic Pistol','Combat Pistol','Double Action Revolver','Heavy Pistol','Heavy Revolver','Heavy Revolver Mk II','Marksman Pistol','Navy Revolver','Perico Pistol','Pistol .50','SNS Pistol Mk II','WM 29 Pistol','Pistol Mk II','Beretta M9A3',
  // Class 3
  'AP Pistol','Assault Shotgun','Assault SMG','Bullpup Shotgun','Combat PDW','Combat Shotgun','Double Barrel Shotgun','Gusenberg Sweeper','Heavy Shotgun','Machine Pistol','Micro SMG','Mini SMG','Pump Shotgun','Pump Shotgun Mk II','Sawed-Off Shotgun','SMG','SMG Mk II','Sweeper Shotgun','Tactical SMG',
  // Class 4
  'Advanced Rifle','Assault Rifle','Assault Rifle Mk II','Battle Rifle','Bullpup Rifle','Bullpup Rifle Mk II','Carbine Rifle','Carbine Rifle Mk II','Heavy Rifle','Heavy Sniper','Heavy Sniper Mk II','Marksman Rifle','Marksman Rifle Mk II','Military Rifle','Musket','Precision Rifle','Service Carbine','Sniper Rifle','Special Carbine','Special Carbine Mk II','Remington Rifle','Compact Rifle',
  // Class 5
  'BZ Gas Grenades','Compact Grenade','Grenade','Molotov Cocktail','Pipe Bombs','Proximity Mines','Sticky Bomb','Grill bombs','Box Bombs',
  // more to take off
  'melee weapon','jerry can','lighter','alcohol','handcuffs','bolt cutters','lockpicks'
];

// NOT contraband (No)
const CONTRA_NO = [
  'cigarettes','food','drinks','lunchbox','camera','pets','skateboard','remote','phone','radio','med kit','armor','bandaid','toys','wallet'
];

// NEGOTIATIONS steps
const STEPS = [
  'Go to the door',
  'Introduce yourself',
  'Make contact with the robber',
  'Get proof of robbery',
  'Ask them how many inside and outside',
  'Ask them to speak to the hostage',
  'See if hostage has been treated okay, do they need medical water or food?',
  'Get demands from the robbers',
  'Relay information to scene command',
  'Relay information to robbers from scene command',
  'Wait for scene command to set up a pursuit line up'
];

// WEAPON CLASSES
const WEAPON_CLASSES = {
  // Class 2
  'Ceramic Pistol':'Class 2 Weapon','Combat Pistol':'Class 2 Weapon','Double Action Revolver':'Class 2 Weapon','Heavy Pistol':'Class 2 Weapon','Heavy Revolver':'Class 2 Weapon','Heavy Revolver Mk II':'Class 2 Weapon','Marksman Pistol':'Class 2 Weapon','Navy Revolver':'Class 2 Weapon','Perico Pistol':'Class 2 Weapon','Pistol .50':'Class 2 Weapon','SNS Pistol Mk II':'Class 2 Weapon','WM 29 Pistol':'Class 2 Weapon','Pistol Mk II':'Class 2 Weapon','Beretta M9A3':'Class 2 Weapon',
  // Class 3
  'AP Pistol':'Class 3 Weapon','Assault Shotgun':'Class 3 Weapon','Assault SMG':'Class 3 Weapon','Bullpup Shotgun':'Class 3 Weapon','Combat PDW':'Class 3 Weapon','Combat Shotgun':'Class 3 Weapon','Double Barrel Shotgun':'Class 3 Weapon','Gusenberg Sweeper':'Class 3 Weapon','Heavy Shotgun':'Class 3 Weapon','Machine Pistol':'Class 3 Weapon','Micro SMG':'Class 3 Weapon','Mini SMG':'Class 3 Weapon','Pump Shotgun':'Class 3 Weapon','Pump Shotgun Mk II':'Class 3 Weapon','Sawed-Off Shotgun':'Class 3 Weapon','SMG':'Class 3 Weapon','SMG Mk II':'Class 3 Weapon','Sweeper Shotgun':'Class 3 Weapon','Tactical SMG':'Class 3 Weapon',
  // Class 4
  'Advanced Rifle':'Class 4 Weapon','Assault Rifle':'Class 4 Weapon','Assault Rifle Mk II':'Class 4 Weapon','Battle Rifle':'Class 4 Weapon','Bullpup Rifle':'Class 4 Weapon','Bullpup Rifle Mk II':'Class 4 Weapon','Carbine Rifle':'Class 4 Weapon','Carbine Rifle Mk II':'Class 4 Weapon','Heavy Rifle':'Class 4 Weapon','Heavy Sniper':'Class 4 Weapon','Heavy Sniper Mk II':'Class 4 Weapon','Marksman Rifle':'Class 4 Weapon','Marksman Rifle Mk II':'Class 4 Weapon','Military Rifle':'Class 4 Weapon','Musket':'Class 4 Weapon','Precision Rifle':'Class 4 Weapon','Service Carbine':'Class 4 Weapon','Sniper Rifle':'Class 4 Weapon','Special Carbine':'Class 4 Weapon','Special Carbine Mk II':'Class 4 Weapon','Remington Rifle':'Class 4 Weapon','Compact Rifle':'Class 4 Weapon',
  // Class 5
  'BZ Gas Grenades':'Class 5 Weapon','Compact Grenade':'Class 5 Weapon','Grenade':'Class 5 Weapon','Molotov Cocktail':'Class 5 Weapon','Pipe Bombs':'Class 5 Weapon','Proximity Mines':'Class 5 Weapon','Sticky Bomb':'Class 5 Weapon','Grill bombs':'Class 5 Weapon','Box Bombs':'Class 5 Weapon'
};

// DRUG CLASSES
const DRUG_CLASSES = {
  // P.C. 110 ‚Äî Class A
  'Cocaine':'Class A Substance','Crack':'Class A Substance','Methamphetamine (Meth)':'Class A Substance','Psilocybe Cyanescens (Shrooms)':'Class A Substance',
  // P.C. 111 ‚Äî Class B
  'Marijuana (Weed)':'Class B Substance','Lysergic Acid Diethylamide (Acid)':'Class B Substance','Lean':'Class B Substance',
  // P.C. 126 ‚Äî Narcotics
  'Painkillers':'Narcotics','Antibiotics':'Narcotics','Fentanyl':'Narcotics','OxyContin (Oxy)':'Narcotics'
};

function $(id){return document.getElementById(id)}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

let deck=[...CODES]; let index=0;
// include alltime in saved stats
let stats=JSON.parse(localStorage.getItem('cadet_stats')||'{"seen":0,"correct":0,"streak":0,"alltime":0}');
function setStats(){
  $('seen').textContent=stats.seen;
  $('correct').textContent=stats.correct;
  $('streak').textContent=stats.streak;
  if($('alltime')) $('alltime').textContent = stats.alltime||0;
  localStorage.setItem('cadet_stats',JSON.stringify(stats));
}

$('theme').onchange=()=>{ document.body.setAttribute('data-theme',$('theme').value) };
$('mode').onchange=()=> switchMode($('mode').value);
function switchMode(m){
  $('tag').textContent =
    m==='flash'?'Flashcards':
    m==='quiz'?'Quiz':
    m==='match'?'Matching':
    m==='caselaw'?'Case Law Quiz':
    m==='contraband'?'Contraband Quiz':
    m==='negotiations'?'Negotiations Quiz':
    m==='weapons'?'Weapon Class Quiz':'Drug Class Quiz';

  $('flashSection').style.display = m==='flash'?'':'none';
  $('quizSection').style.display  = m==='quiz'?'':'none';
  $('matchSection').style.display = m==='match'?'':'none';
  $('caseSection').style.display  = m==='caselaw'?'':'none';
  $('contrabandSection').style.display = m==='contraband'?'':'none';
  $('negotiationsSection').style.display = m==='negotiations'?'':'none';
  $('weaponSection').style.display = m==='weapons'?'':'none';
  $('drugSection').style.display = m==='drugs'?'':'none';

  if(m==='quiz') startQuiz();
  if(m==='match') startMatch();
  if(m==='caselaw') startCase();
  if(m==='contraband') startContra();
  if(m==='negotiations') startNeg();
  if(m==='weapons') startWeap();
  if(m==='drugs') startDrug();
}

const front=$('front'), back=$('back'), flipper=$('flipper');
function updateCard(){ const it=deck[index]; front.textContent=it.c; back.textContent=it.m; flipper.classList.remove('flipped'); requestAnimationFrame(()=>{ autoFit(front, 34, 14); autoFit(back, 34, 14); }); }

function fitText(el,max,min){
  let size=max; el.style.fontSize=size+'px';
  while((el.scrollHeight>el.clientHeight||el.scrollWidth>el.clientWidth) && size>min){
    size--; el.style.fontSize=size+'px';
  }
}
flipper.addEventListener('click',()=> flipper.classList.toggle('flipped'));
$('markRight').onclick=()=>{ 
  stats.seen++; stats.correct++; stats.streak++;
  if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak;
  setStats(); nextCard(); 
};
$('markWrong').onclick=()=>{ stats.seen++; stats.streak=0; setStats(); nextCard(); };
function nextCard(){ index=(index+1)%deck.length; updateCard(); }
$('shuffleBtn').onclick=()=>{ deck=shuffle(deck); index=0; updateCard(); };
$('resetBtn').onclick=()=>{ stats={seen:0,correct:0,streak:0,alltime:stats.alltime||0}; setStats(); };
$('resetAllBtn').onclick=()=>{ stats.alltime=0; setStats(); };

// QUIZ
let quizQ=[], qi=0, qScore=0, qLocked=false;
function startQuiz(){ quizQ = shuffle([...CODES]).slice(0,10); qi=0; qScore=0; qLocked=false; renderQ(); }
function renderQ(){ const q=quizQ[qi]; $('qtext').textContent=`What does ${q.c} mean?`; $('qcount').textContent=`Q${qi+1}/${quizQ.length}`; $('qscore').textContent=`${qScore} correct`; const opts=shuffle([q,...shuffle(CODES.filter(x=>x!==q)).slice(0,3)]).map(o=>o.m); const box=$('choices'); box.innerHTML=''; qLocked=false; opts.forEach(txt=>{ const d=document.createElement('div'); d.className='choice'; d.textContent=txt; d.onclick=()=>{ if(qLocked) return; qLocked=true; const ok=txt===q.m; d.classList.add(ok?'correct':'wrong'); stats.seen++; if(ok){ stats.correct++; stats.streak++; if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak; qScore++; } else { stats.streak=0; [...box.children].forEach(el=>{ if(el.textContent===q.m) el.classList.add('correct'); }); } setStats(); }; box.appendChild(d); }); }
$('nextQ').onclick=()=>{ if(qi<quizQ.length-1){ qi++; renderQ(); } else { startQuiz(); } };
$('restartQuiz').onclick=startQuiz;

// MATCHING
function startMatch(){
  const grid=$('matchGrid'); grid.innerHTML='';
  const pairs=shuffle([...CODES]).slice(0,8);
  const left=pairs.map(p=>({t:p.c,k:p.c,side:'L'}));
  const right=shuffle(pairs.map(p=>({t:p.m,k:p.c,side:'R'})));
  const items=shuffle([...left,...right]);
  let sel=null; let solved=new Set();
  $('mleft').textContent = pairs.length + ' pairs left';
  items.forEach(it=>{
    const d=document.createElement('div');
    d.className='match-item'; d.textContent=it.t; d.dataset.key=it.k; d.dataset.side=it.side;
    d.onclick=()=>{
      if(solved.has(d.dataset.key)) return;
      if(!sel){ sel=d; d.classList.add('sel'); return; }
      if(sel===d){ sel.classList.remove('sel'); sel=null; return; }
      stats.seen++;
      const isMatch = (sel.dataset.key===d.dataset.key && sel.dataset.side!==d.dataset.side);
      if(isMatch){
        stats.correct++; stats.streak++;
        if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak;
        d.classList.add('correct'); sel.classList.add('correct');
        solved.add(d.dataset.key);
        $('mleft').textContent = (pairs.length - solved.size) + ' pairs left';
        setTimeout(()=>{ d.style.visibility='hidden'; sel.style.visibility='hidden'; sel=null; },220);
        if(solved.size === pairs.length){ setTimeout(()=>{ startMatch(); toast('New board ready'); }, 350); }
      } else {
        stats.streak=0; d.classList.add('wrong'); sel.classList.add('wrong');
        setTimeout(()=>{ d.classList.remove('wrong'); sel.classList.remove('wrong'); sel.classList.remove('sel'); sel=null; },300);
      }
      setStats();
    };
    grid.appendChild(d);
  });
}
$('restartMatch').onclick=startMatch;

function toast(msg){
  const b=document.createElement('div'); b.textContent=msg; b.style.position='fixed'; b.style.left='50%'; b.style.top='12px'; b.style.transform='translateX(-50%)'; b.style.background='linear-gradient(90deg, rgba(255,255,255,.2), rgba(255,255,255,.06))'; b.style.border='1px solid rgba(255,255,255,.2)'; b.style.padding='10px 16px'; b.style.borderRadius='999px'; b.style.backdropFilter='blur(6px)'; b.style.zIndex='9999'; document.body.appendChild(b); setTimeout(()=>b.remove(),1200);
}

// CASE LAW QUIZ
let caseQ=[], ci=0, cScore=0, cLocked=false;
function startCase(){ caseQ=shuffle([...CASES]).slice(0,10); ci=0; cScore=0; cLocked=false; renderCase(); }
function renderCase(){ const q=caseQ[ci]; $('cqtext').textContent=q.sum; $('cqcount').textContent=`Case ${ci+1}/${caseQ.length}`; $('cqscore').textContent=`${cScore} correct`; const opts=shuffle([q,...shuffle(CASES.filter(x=>x!==q)).slice(0,3)]).map(o=>o.name); const box=$('cchoices'); box.innerHTML=''; cLocked=false; opts.forEach(txt=>{ const d=document.createElement('div'); d.className='choice'; d.textContent=txt; d.onclick=()=>{ if(cLocked) return; cLocked=true; const ok=txt===q.name; d.classList.add(ok?'correct':'wrong'); stats.seen++; if(ok){ stats.correct++; stats.streak++; if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak; cScore++; } else { stats.streak=0; [...box.children].forEach(el=>{ if(el.textContent===q.name) el.classList.add('correct'); }); } setStats(); }; box.appendChild(d); }); }
$('nextCase').onclick=()=>{ if(ci<caseQ.length-1){ ci++; renderCase(); } else { startCase(); } };
$('restartCase').onclick=startCase;

// CONTRABAND QUIZ (Yes/No)
let bQ=[], bi=0, bScore=0, bLocked=false;
function startContra(){
  const pool = [...CONTRA_YES.map(n=>({name:n, yes:true})), ...CONTRA_NO.map(n=>({name:n, yes:false}))];
  bQ = shuffle(pool).slice(0,10);
  bi=0; bScore=0; bLocked=false; renderContra();
}
function renderContra(){
  const q=bQ[bi];
  $('btext').textContent = `Is possession of "${q.name}" considered contraband?`;
  $('bcount').textContent=`Q${bi+1}/${bQ.length}`;
  $('bscore').textContent=`${bScore} correct`;
  const box=$('bchoices'); box.innerHTML=''; bLocked=false;
  ['Yes','No'].forEach(ans=>{
    const d=document.createElement('div'); d.className='choice'; d.textContent=ans;
    d.onclick=()=>{
      if(bLocked) return; bLocked=true;
      const ok = (ans==='Yes') === q.yes;
      d.classList.add(ok?'correct':'wrong');
      stats.seen++;
      if(ok){ stats.correct++; stats.streak++; if(stats.streak>(stats.alltime||0)) stats.alltime=stats.streak; bScore++; }
      else { stats.streak=0; }
      // reveal correct
      [...box.children].forEach(el=>{
        const should = q.yes ? 'Yes' : 'No';
        if(el.textContent===should) el.classList.add('correct');
      });
      setStats();
    };
    box.appendChild(d);
  });
}
$('nextContra').onclick=()=>{ if(bi<bQ.length-1){ bi++; renderContra(); } else { startContra(); } };
$('restartContra').onclick=startContra;

// NEGOTIATIONS QUIZ
let nI=0, nScore=0, nLocked=false;
function startNeg(){ nI=0; nScore=0; nLocked=false; renderNeg(); }
function renderNeg(){
  const prompt = nI===0 ? 'What is the FIRST step?' : `What comes AFTER: "${STEPS[nI-1]}"?`;
  $('ntext').textContent = prompt;
  $('ncount').textContent = `Step ${nI+1}/${STEPS.length}`;
  $('nscore').textContent = `${nScore} correct`;
  const opts = shuffle([STEPS[nI], ...shuffle(STEPS.filter((_,i)=>i!==nI)).slice(0,3)]);
  const box=$('nchoices'); box.innerHTML=''; nLocked=false;
  opts.forEach(txt=>{
    const d=document.createElement('div'); d.className='choice'; d.textContent=txt;
    d.onclick=()=>{
      if(nLocked) return; nLocked=true;
      const ok = (txt===STEPS[nI]);
      d.classList.add(ok?'correct':'wrong');
      stats.seen++;
      if(ok){
        stats.correct++; stats.streak++; if(stats.streak>(stats.alltime||0)) stats.alltime=stats.streak; nScore++;
      } else {
        stats.streak=0;
        [...box.children].forEach(el=>{ if(el.textContent===STEPS[nI]) el.classList.add('correct'); });
      }
      setStats();
    };
    box.appendChild(d);
  });
}
$('nextNeg').onclick=()=>{ if(nI<STEPS.length-1){ nI++; renderNeg(); } else { startNeg(); } };
$('restartNeg').onclick=startNeg;

// WEAPON CLASS QUIZ
let wQ=[], wi=0, wScore=0, wLocked=false;
function startWeap(){
  const weapons = Object.keys(WEAPON_CLASSES);
  wQ = shuffle(weapons).slice(0,10);
  wi=0; wScore=0; wLocked=false; renderWeap();
}
function renderWeap(){
  const name=wQ[wi]; const answer=WEAPON_CLASSES[name];
  $('wtext').textContent = `What class is "${name}"?`;
  $('wcount').textContent = `Q${wi+1}/${wQ.length}`;
  $('wscore').textContent = `${wScore} correct`;
  const opts = shuffle(['Class 2 Weapon','Class 3 Weapon','Class 4 Weapon','Class 5 Weapon']);
  const box=$('wchoices'); box.innerHTML=''; wLocked=false;
  opts.forEach(txt=>{
    const d=document.createElement('div'); d.className='choice'; d.textContent=txt;
    d.onclick=()=>{
      if(wLocked) return; wLocked=true;
      const ok = (txt===answer);
      d.classList.add(ok?'correct':'wrong');
      stats.seen++;
      if(ok){ stats.correct++; stats.streak++; if(stats.streak>(stats.alltime||0)) stats.alltime=stats.streak; wScore++; }
      else { stats.streak=0; }
      // reveal correct
      [...box.children].forEach(el=>{ if(el.textContent===answer) el.classList.add('correct'); });
      setStats();
    };
    box.appendChild(d);
  });
}
$('nextWeap').onclick=()=>{ if(wi<wQ.length-1){ wi++; renderWeap(); } else { startWeap(); } };
$('restartWeap').onclick=startWeap;

// DRUG CLASS QUIZ
let dQ=[], di=0, dScore=0, dLocked=false;
function startDrug(){
  const drugs = Object.keys(DRUG_CLASSES);
  dQ = shuffle(drugs).slice(0,10);
  di=0; dScore=0; dLocked=false; renderDrug();
}
function renderDrug(){
  const name=dQ[di]; const answer=DRUG_CLASSES[name];
  $('dtext').textContent = `Which category is "${name}"?`;
  $('dcount').textContent = `Q${di+1}/${dQ.length}`;
  $('dscore').textContent = `${dScore} correct`;
  const opts = shuffle(['Class A Substance','Class B Substance','Narcotics']);
  const box=$('dchoices'); box.innerHTML=''; dLocked=false;
  opts.forEach(txt=>{
    const d=document.createElement('div'); d.className='choice'; d.textContent=txt;
    d.onclick=()=>{
      if(dLocked) return; dLocked=true;
      const ok = (txt===answer);
      d.classList.add(ok?'correct':'wrong');
      stats.seen++;
      if(ok){ stats.correct++; stats.streak++; if(stats.streak>(stats.alltime||0)) stats.alltime=stats.streak; dScore++; }
      else { stats.streak=0; }
      [...box.children].forEach(el=>{ if(el.textContent===answer) el.classList.add('correct'); });
      setStats();
    };
    box.appendChild(d);
  });
}
$('nextDrug').onclick=()=>{ if(di<dQ.length-1){ di++; renderDrug(); } else { startDrug(); } };
$('restartDrug').onclick=startDrug;

// INIT
updateCard(); setStats();

// Re-fit on resize
window.addEventListener('resize',()=>{ autoFit(front,34,14); autoFit(back,34,14); });

// Auto-fit helper: shrink font size until the content fits
function autoFit(el, maxPx=34, minPx=14){
  if(!el) return; let size=maxPx; el.style.fontSize=size+'px';
  const maxH = el.clientHeight - 16; const maxW = el.clientWidth - 16;
  while((el.scrollHeight>maxH || el.scrollWidth>maxW) && size>minPx){ size-=1; el.style.fontSize=size+'px'; }
}
</script>
</body>
</html>

