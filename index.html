<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cadet Trainer ‚Äî 10-Codes Flashcards, Quiz & Matching</title>
<style>
  :root{
    --bg:#0e1220;
    --panel:#151a2b;
    --ink:#e8eaf6;
    --muted:#9aa3b2;
    --accent:#9aa3b2;
    --accent-strong:#cfd4df;
    --card:#11172a;
    --success:#22a05d;
    --danger:#d64545;
    --radius:22px;
    --shadow:0 18px 50px rgba(0,0,0,.35);
  }

  [data-theme="sasp"]{ --bg:#0e1220; --panel:#151a2b; --ink:#e8eaf6; --muted:#9aa3b2; --accent:#9aa3b2; --accent-strong:#cfd4df; --card:#11172a; }
  [data-theme="bcso"]{ --bg:#17140f; --panel:#1f1a12; --ink:#fff8e6; --muted:#d2c5aa; --accent:#c7a976; --accent-strong:#efd9a7; --card:#19140e; }
  [data-theme="highway"]{ --bg:#071226; --panel:#0b1d35; --ink:#e6f2ff; --muted:#a8c2e5; --accent:#2e6ac9; --accent-strong:#a7c8ff; --card:#0a1730; }

  body{margin:0;font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--ink);display:flex;min-height:100vh;align-items:center;justify-content:center;padding:20px;}
  .app{ width:min(1200px,100%); display:grid; grid-template-columns:320px 1fr; gap:24px; margin:0 auto; align-items:start; }
  .sidebar{ background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; position:sticky; top:20px; align-self:start; height:max-content; border:1px solid rgba(255,255,255,.06); }
  h1{font-size:24px;margin:0 0 6px;font-weight:900}
  .sub{color:var(--muted);font-size:13px;margin:0 0 12px}
  .select{width:100%;padding:12px 14px;background:var(--card);color:var(--ink);border:1px solid rgba(255,255,255,.08);border-radius:14px;margin:8px 0 14px;cursor:pointer;}
  .stat{display:flex;justify-content:space-between;background:var(--card);border-radius:14px;padding:10px 14px;margin:6px 0;border:1px solid rgba(255,255,255,.06)}
  .panel{ background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px; min-height:600px; border:1px solid rgba(255,255,255,.06); overflow:auto; }
  .toolbar{display:flex;justify-content:space-between;margin-bottom:14px}
  .tag{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);color:var(--accent-strong);font-size:12px;}
  .btn{padding:10px 14px;border-radius:14px;background:var(--accent);color:#0c0f18;font-weight:800;border:none;cursor:pointer;}
  .btn.ghost{background:transparent;color:var(--accent-strong);border:1px solid rgba(255,255,255,.14)}
  .cardwrap{display:grid;place-items:center;padding:20px;}
  .card{width:100%;min-height:240px;perspective:1200px;}
  .face{ background:linear-gradient(180deg, var(--card), rgba(255,255,255,.02)); color:var(--ink); border-radius:28px; padding:30px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.08); font-size:clamp(16px, 2.8vw, 34px); font-weight:900; line-height:1.15; display:flex; align-items:center; justify-content:center; text-align:center; height:100%; transition:transform .6s ease, box-shadow .3s ease; transform-style:preserve-3d; overflow-wrap:anywhere; word-break:break-word; hyphens:auto; }
  .flipper{position:relative}
  .flipper .front,.flipper .back{position:absolute;inset:0;backface-visibility:hidden}
  .flipper .back{transform:rotateY(180deg)}
  .flipped .front{transform:rotateY(180deg)}
  .flipped .back{transform:rotateY(360deg)}
  .qwrap{display:grid;gap:14px}
  .q{padding:18px;border-radius:16px;background:var(--card);border:1px solid rgba(255,255,255,.08)}
  .choices{display:grid;gap:10px;margin-top:8px}
  .choice{padding:12px 14px;border-radius:12px;background:rgba(255,255,255,.05);cursor:pointer;border:1px solid rgba(255,255,255,.08)}
  .choice.correct{outline:2px solid var(--success);background:rgba(34,160,93,.12)}
  .choice.wrong{outline:2px solid var(--danger);background:rgba(214,69,69,.12)}
  .match-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  .match-item{padding:10px;border-radius:10px;background:var(--card);cursor:pointer;border:1px solid rgba(255,255,255,.08);font-size:14px}
  .match-item.correct{background:rgba(34,160,93,.2)}
  .match-item.wrong{background:rgba(214,69,69,.2)}
  /* Matching styles */
  .match-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
  @media (max-width: 820px){ .match-grid{ grid-template-columns:1fr } }
  .match-item{ padding:12px; border-radius:12px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); cursor:pointer; user-select:none }
  .match-item.sel{ outline:2px solid var(--accent-strong); background:rgba(255,255,255,.08) }
  .match-item.correct{ outline:2px solid var(--success); background:rgba(34,160,93,.12) }
  .match-item.wrong{ outline:2px solid var(--danger); background:rgba(214,69,69,.12) }
</style>
</head>
<body data-theme="sasp">
<div id="root-app" class="app">
  <aside class="sidebar">
    <h1>Cadet Trainer</h1>
    <p class="sub">Practice 10-codes and case laws. Flashcards, quiz, or matching.</p>

    <label class="sub">Theme</label>
    <select class="select" id="theme">
      <option value="sasp">SASP ‚Äî Black/Grey</option>
      <option value="bcso">BCSO ‚Äî Tan</option>
      <option value="highway">Highway ‚Äî Blue</option>
    </select>

    <label class="sub">Mode</label>
    <select class="select" id="mode">
      <option value="flash">Flashcards</option>
      <option value="quiz">Quiz</option>
      <option value="match">Matching</option>
      <option value="caselaw">Case Law Quiz</option>
    </select>

    <div class="stat"><span>Seen</span><strong id="seen">0</strong></div>
    <div class="stat"><span>Correct</span><strong id="correct">0</strong></div>
    <div class="stat"><span>Streak</span><strong id="streak">0</strong></div>
    <!-- NEW: All-time streak tile -->
    <div class="stat"><span>All-time Streak üèÜ</span><strong id="alltime">0</strong></div>

    <button class="btn ghost" id="shuffleBtn" style="width:100%;margin-top:12px">Shuffle Deck</button>
    <button class="btn ghost" id="resetBtn" style="width:100%;margin-top:8px">Reset Stats</button>
    <!-- NEW: Reset all-time button -->
    <button class="btn ghost" id="resetAllBtn" style="width:100%;margin-top:8px">Reset All-time Streak</button>
  </aside>

  <main class="panel">
    <div class="toolbar"><span class="tag" id="tag">Flashcards</span></div>

    <section id="flashSection" class="cardwrap">
      <div class="card"><div class="flipper" id="flipper"><div class="face front" id="front">Tap card to flip</div><div class="face back" id="back"></div></div></div>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button class="btn ghost" id="markWrong">Wrong</button>
        <button class="btn" id="markRight">Right</button>
      </div>
    </section>

    <section id="quizSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="qcount">Question</div><div id="qscore">0 correct</div></div>
          <h2 id="qtext"></h2>
          <div class="choices" id="choices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartQuiz">Restart</button>
          <button class="btn" id="nextQ">Next</button>
        </div>
      </div>
    </section>

    <section id="matchSection" style="display:none">
        <div class="qmeta" style="margin-bottom:10px"><div id="mcount">Match the pairs</div><div id="mleft"></div></div>
        <div id="matchGrid" class="match-grid"></div>
        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px">
          <button class="btn ghost" id="restartMatch">New Board</button>
        </div>
      </section>

    <section id="caseSection" style="display:none">
      <div class="qwrap">
        <div class="q">
          <div class="qmeta"><div id="cqcount">Case Question</div><div id="cqscore">0 correct</div></div>
          <h2 id="cqtext"></h2>
          <div class="choices" id="cchoices"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="restartCase">Restart</button>
          <button class="btn" id="nextCase">Next</button>
        </div>
      </div>
    </section>

  </main>
</div>
<script>
// === DATA ===
const CODES = [
  {c:'Code 0', m:'Game Crash'},
  {c:'Code 1', m:'Routing Call (No Lights | No Sirens)'},
  {c:'Code 2', m:'Routing Call (Lights | No Sirens | Airhorn at Intersections)'},
  {c:'Code 3', m:'Emergency (Lights | Sirens)'},
  {c:'Code 4', m:'All Clear'},
  {c:'Code 5', m:'Initiate Felony Stop'},
  {c:'Code 6', m:'Investigating the Area'},
  {c:'10-1', m:'Unable to Copy'},
  {c:'10-2', m:'Loud and Clear'},
  {c:'10-3', m:'Stop Radio Chatter'},
  {c:'10-4', m:'Acknowledgment'},
  {c:'10-5', m:'Ballistics Testing'},
  {c:'10-6', m:'Busy, unless urgent'},
  {c:'10-7', m:'Out of Service'},
  {c:'10-8', m:'Back in Service'},
  {c:'10-9', m:'Repeat'},
  {c:'10-10', m:'Negative'},
  {c:'10-11', m:'Traffic Stop'},
  {c:'10-13', m:'Shots Fired'},
  {c:'10-14', m:'Officer Down'},
  {c:'10-15', m:'Suspect in Custody'},
  {c:'10-19', m:'Return to Station'},
  {c:'10-20', m:'Location'},
  {c:'10-22', m:'Disregard'},
  {c:'10-23', m:'Arrived at the Scene'},
  {c:'10-25', m:'Report in Person'},
  {c:'10-28', m:'Vehicle Registration'},
  {c:'10-29', m:'Warrant Check'},
  {c:'10-31', m:'Crime in Progress'},
  {c:'10-32', m:'Person with a Gun'},
  {c:'10-33', m:'Drug Sales'},
  {c:'10-39', m:'Status Report'},
  {c:'10-41', m:'On Duty'},
  {c:'10-42', m:'Off Duty'},
  {c:'10-47', m:'Injured Person'},
  {c:'10-50', m:'Vehicle Accident'},
  {c:'10-51', m:'Requesting a Tow Truck'},
  {c:'10-52', m:'EMS Needed'},
  {c:'10-53', m:'Requesting Supervisor'},
  {c:'10-55', m:'Intoxicated Driver'},
  {c:'10-56', m:'Intoxicated Pedestrian'},
  {c:'10-57', m:'Hit & Run'},
  {c:'10-60', m:'Stolen Vehicle'},
  {c:'10-66', m:'Suspicious Person'},
  {c:'10-67', m:'Carjacking (GTA)'},
  {c:'10-71', m:'Shooting'},
  {c:'10-72', m:'Hostage Situation'},
  {c:'10-76', m:'En-route'},
  {c:'10-77', m:'Need Backup (Non-Emergency)'},
  {c:'10-78', m:'Need Backup (Emergency)'},
  {c:'10-79', m:'ETA (Estimated Time of Arrival)'},
  {c:'10-80', m:'Vehicle Pursuit'},
  {c:'10-81', m:'Foot Pursuit'},
  {c:'10-90', m:'Robbery in Progress'},
  {c:'10-91', m:'Transport Unit'},
  {c:'10-94', m:'Reckless Driver'},
  {c:'10-99', m:'Officer in Distress'}
];

const CASES = [
  {name:'Tennessee v. Garner', sum:'Deadly force to stop a fleeing suspect only if there is a good-faith belief the suspect poses a significant threat of death or serious injury to officers or others.'},
  {name:'Maryland v. King', sum:'After arrest on probable cause, an individual may be fingerprinted, photographed, and have DNA taken without a warrant.'},
  {name:'Florida v. J.L.', sum:'An anonymous tip alone is not enough for a search or frisk; it can help corroborate reasonable suspicion for an investigatory stop.'},
  {name:'Mapp v. Ohio', sum:'Evidence obtained unlawfully may not be used in prosecution (exclusionary rule).'},
  {name:'Carroll v. United States', sum:'With probable cause, a vehicle can be searched without a warrant (automobile exception). Buildings generally require a warrant.'},
  {name:'Miranda v. Arizona', sum:'Suspects must be warned of their rights prior to questioning; otherwise statements are inadmissible unless rights were knowingly and intelligently waived.'},
  {name:'Terry v. Ohio', sum:'With reasonable suspicion a suspect committed, is committing, or is about to commit a crime and may be armed and dangerous, an officer may conduct a stop-and-frisk based on specific articulable facts.'},
  {name:'Whren v. U.S.', sum:'A vehicle may be stopped when there is probable cause of a traffic violation, even if the officer‚Äôs actual intent is not traffic enforcement; a traffic stop is a form of detention.'},
  {name:'Pennsylvania v. Mimms', sum:'During a lawful traffic stop, officers may order the driver out of the car and conduct a pat-down for weapons under Terry criteria.'},
  {name:'Maryland v. Wilson', sum:'Extends Mimms to passengers‚Äîofficers may order passengers out and pat them down under Terry criteria.'},
  {name:'Brendlin v. California', sum:'A lawful traffic stop detains passengers as well as the driver; no one is free to depart without police permission.'}
];

function $(id){return document.getElementById(id)}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

let deck=[...CODES]; let index=0;
// UPDATED: include alltime in saved stats
let stats=JSON.parse(localStorage.getItem('cadet_stats')||'{"seen":0,"correct":0,"streak":0,"alltime":0}');
function setStats(){
  $('seen').textContent=stats.seen;
  $('correct').textContent=stats.correct;
  $('streak').textContent=stats.streak;
  if($('alltime')) $('alltime').textContent = stats.alltime||0;
  localStorage.setItem('cadet_stats',JSON.stringify(stats));
}

$('theme').onchange=()=>{ document.body.setAttribute('data-theme',$('theme').value) };
$('mode').onchange=()=> switchMode($('mode').value);
function switchMode(m){ $('tag').textContent = m==='flash'?'Flashcards': m==='quiz'?'Quiz': m==='match'?'Matching':'Case Law Quiz'; $('flashSection').style.display = m==='flash'?'':'none'; $('quizSection').style.display = m==='quiz'?'':'none'; $('matchSection').style.display = m==='match'?'':'none'; $('caseSection').style.display = m==='caselaw'?'':'none'; if(m==='quiz') startQuiz(); if(m==='match') startMatch(); if(m==='caselaw') startCase(); }

const front=$('front'), back=$('back'), flipper=$('flipper');
function updateCard(){ const it=deck[index]; front.textContent=it.c; back.textContent=it.m; flipper.classList.remove('flipped'); requestAnimationFrame(()=>{ autoFit(front, 34, 14); autoFit(back, 34, 14); }); }

function fitText(el,max,min){
  let size=max; el.style.fontSize=size+'px';
  while((el.scrollHeight>el.clientHeight||el.scrollWidth>el.clientWidth) && size>min){
    size--; el.style.fontSize=size+'px';
  }
}
flipper.addEventListener('click',()=> flipper.classList.toggle('flipped'));
$('markRight').onclick=()=>{ 
  stats.seen++; stats.correct++; stats.streak++;
  // NEW: bump all-time record if needed
  if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak;
  setStats(); nextCard(); 
};
$('markWrong').onclick=()=>{ stats.seen++; stats.streak=0; setStats(); nextCard(); };
function nextCard(){ index=(index+1)%deck.length; updateCard(); }
$('shuffleBtn').onclick=()=>{ deck=shuffle(deck); index=0; updateCard(); };
$('resetBtn').onclick=()=>{ stats={seen:0,correct:0,streak:0,alltime:stats.alltime||0}; setStats(); };
// NEW: reset all-time handler
$('resetAllBtn').onclick=()=>{ stats.alltime=0; setStats(); };

// QUIZ
let quizQ=[], qi=0, qScore=0, qLocked=false;
function startQuiz(){ quizQ = shuffle([...CODES]).slice(0,10); qi=0; qScore=0; qLocked=false; renderQ(); }
function renderQ(){ const q=quizQ[qi]; $('qtext').textContent=`What does ${q.c} mean?`; $('qcount').textContent=`Q${qi+1}/${quizQ.length}`; $('qscore').textContent=`${qScore} correct`; const opts=shuffle([q,...shuffle(CODES.filter(x=>x!==q)).slice(0,3)]).map(o=>o.m); const box=$('choices'); box.innerHTML=''; qLocked=false; opts.forEach(txt=>{ const d=document.createElement('div'); d.className='choice'; d.textContent=txt; d.onclick=()=>{ if(qLocked) return; qLocked=true; const ok=txt===q.m; d.classList.add(ok?'correct':'wrong'); stats.seen++; if(ok){ stats.correct++; stats.streak++; if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak; qScore++; } else { stats.streak=0; [...box.children].forEach(el=>{ if(el.textContent===q.m) el.classList.add('correct'); }); } setStats(); }; box.appendChild(d); }); }
$('nextQ').onclick=()=>{ if(qi<quizQ.length-1){ qi++; renderQ(); } else { startQuiz(); } };
$('restartQuiz').onclick=startQuiz;

// MATCHING
function startMatch(){
  const grid=$('matchGrid'); grid.innerHTML='';
  const pairs=shuffle([...CODES]).slice(0,8);
  const left=pairs.map(p=>({t:p.c,k:p.c,side:'L'}));
  const right=shuffle(pairs.map(p=>({t:p.m,k:p.c,side:'R'})));
  const items=shuffle([...left,...right]);
  let sel=null; let solved=new Set();
  $('mleft').textContent = pairs.length + ' pairs left';
  items.forEach(it=>{
    const d=document.createElement('div');
    d.className='match-item'; d.textContent=it.t; d.dataset.key=it.k; d.dataset.side=it.side;
    d.onclick=()=>{
      if(solved.has(d.dataset.key)) return;
      if(!sel){ sel=d; d.classList.add('sel'); return; }
      if(sel===d){ sel.classList.remove('sel'); sel=null; return; }
      stats.seen++;
      const isMatch = (sel.dataset.key===d.dataset.key && sel.dataset.side!==d.dataset.side);
      if(isMatch){
        stats.correct++; stats.streak++;
        // NEW: bump all-time record if needed
        if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak;
        d.classList.add('correct'); sel.classList.add('correct');
        solved.add(d.dataset.key);
        $('mleft').textContent = (pairs.length - solved.size) + ' pairs left';
        setTimeout(()=>{ d.style.visibility='hidden'; sel.style.visibility='hidden'; sel=null; },220);
        // Auto-reset when all pairs matched
        if(solved.size === pairs.length){ setTimeout(()=>{ startMatch(); toast('New board ready'); }, 350); }
      } else {
        stats.streak=0; d.classList.add('wrong'); sel.classList.add('wrong');
        setTimeout(()=>{ d.classList.remove('wrong'); sel.classList.remove('wrong'); sel.classList.remove('sel'); sel=null; },300);
      }
      setStats();
    };
    grid.appendChild(d);
  });
}
$('restartMatch').onclick=startMatch;

function toast(msg){
  const b=document.createElement('div'); b.textContent=msg; b.style.position='fixed'; b.style.left='50%'; b.style.top='12px'; b.style.transform='translateX(-50%)'; b.style.background='linear-gradient(90deg, rgba(255,255,255,.2), rgba(255,255,255,.06))'; b.style.border='1px solid rgba(255,255,255,.2)'; b.style.padding='10px 16px'; b.style.borderRadius='999px'; b.style.backdropFilter='blur(6px)'; b.style.zIndex='9999'; document.body.appendChild(b); setTimeout(()=>b.remove(),1200);
}

// CASE LAW QUIZ
let caseQ=[], ci=0, cScore=0, cLocked=false;
function startCase(){ caseQ=shuffle([...CASES]).slice(0,10); ci=0; cScore=0; cLocked=false; renderCase(); }
function renderCase(){ const q=caseQ[ci]; $('cqtext').textContent=q.sum; $('cqcount').textContent=`Case ${ci+1}/${caseQ.length}`; $('cqscore').textContent=`${cScore} correct`; const opts=shuffle([q,...shuffle(CASES.filter(x=>x!==q)).slice(0,3)]).map(o=>o.name); const box=$('cchoices'); box.innerHTML=''; cLocked=false; opts.forEach(txt=>{ const d=document.createElement('div'); d.className='choice'; d.textContent=txt; d.onclick=()=>{ if(cLocked) return; cLocked=true; const ok=txt===q.name; d.classList.add(ok?'correct':'wrong'); stats.seen++; if(ok){ stats.correct++; stats.streak++; if(stats.streak > (stats.alltime||0)) stats.alltime = stats.streak; cScore++; } else { stats.streak=0; [...box.children].forEach(el=>{ if(el.textContent===q.name) el.classList.add('correct'); }); } setStats(); }; box.appendChild(d); }); }
$('nextCase').onclick=()=>{ if(ci<caseQ.length-1){ ci++; renderCase(); } else { startCase(); } };
$('restartCase').onclick=startCase;

// INIT
updateCard(); setStats();

// Re-fit on resize
window.addEventListener('resize',()=>{ autoFit(front,34,14); autoFit(back,34,14); });

// Auto-fit helper: shrink font size until the content fits
function autoFit(el, maxPx=34, minPx=14){
  if(!el) return; let size=maxPx; el.style.fontSize=size+'px';
  const maxH = el.clientHeight - 16; const maxW = el.clientWidth - 16;
  while((el.scrollHeight>maxH || el.scrollWidth>maxW) && size>minPx){ size-=1; el.style.fontSize=size+'px'; }
}
</script>
